# 从 URL 输入到页面展现到底发生什么？

## 基本过程
- DNS 解析:将域名解析成 IP 地址
- TCP 连接：TCP 三次握手
- 发送 HTTP 请求
- 服务器处理请求并返回 HTTP 报文
- 浏览器解析渲染页面
- 断开连接：TCP 四次挥手

## 解析ip地址的过程
- 查找浏览器缓存
- 查找系统缓存
- 查找路由器缓存
- 向网络运行商(ISP)的DNS服务器查询信息
- 依次递归查找 => 访问根服务器 => 访问.com服务器 => 访问baidu.com服务器


## 三次握手的过程
- 客户端发送一个带 SYN=1（同步序列号），Seq=X 的数据包到服务器端口（第一次握手，由浏览器发起，告诉服务器我要发送请求了）
- 服务器发回一个带 SYN=1（同步序列号）， ACK=X+1（确认应答）， Seq=Y 的响应包以示传达确认信息（第二次握手，由服务器发起，告诉浏览器我准备接受了，你赶紧发送吧）
- 客户端再回传一个带 ACK=Y+1（确认应答）， Seq=Z 的数据包，代表“握手结束”（第三次握手，由浏览器发送，告诉服务器，我马上就发了，准备接受吧）

> “三次握手”的目的是“为了防止已失效的连接请求报文段突然又传送到了服务端，因而产生错误”

## 发送HTTP请求

请求报文由请求行（request line）、请求头（header）、请求体四个部分组成,如下图所示：

![](https://ws1.sinaimg.cn/large/a71efaafly1g21brwf6mmj20h406r0uf.jpg)

## 服务器处理请求并返回 HTTP 报文

http 响应报文：

![](https://ws1.sinaimg.cn/large/a71efaafly1g21bs7xehxj20bb080mxu.jpg)

(1) 响应行包含：协议版本，状态码，状态码描述

状态码规则如下：
- 1xx：指示信息--表示请求已接收，继续处理。
- 2xx：成功--表示请求已被成功接收、理解、接受。
- 3xx：重定向--要完成请求必须进行更进一步的操作。
- 4xx：客户端错误--请求有语法错误或请求无法实现。
- 5xx：服务器端错误--服务器未能实现合法的请求。

(2) 响应头部包含响应报文的附加信息，由 名/值 对组成

(3) 响应主体包含回车符、换行符和响应返回数据，并不是所有响应报文都有响应数据

## 浏览器解析渲染页面

![](https://ws1.sinaimg.cn/large/a71efaafly1g21bsfijrnj20kw0760ti.jpg)

浏览器解析渲染页面分为一下五个步骤：

- 根据 HTML 解析出 DOM 树
- 根据 CSS 解析生成 CSS 规则树
  - CSS 写在 head 内会阻塞 DOM 树的渲染，而不会阻塞DOM树的生成
- 结合 DOM 树和 CSS 规则树，生成渲染树
- 根据渲染树计算每一个节点的信息
- 根据计算好的信息绘制页面

## 断开连接

当数据传送完毕，需要断开 tcp 连接，此时发起 tcp 四次挥手。

![](https://ws1.sinaimg.cn/large/a71efaafly1g21bsm7ci8j20i40ciwic.jpg)
